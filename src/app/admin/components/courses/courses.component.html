<div class="courses-container">
  <div class="courses-header">
    <h2>Course Management</h2>
    <button class="btn-primary" (click)="isCreating.set(true)" *ngIf="!isCreating() && !isEditing()">Create New Course</button>
  </div>

  <!-- Course Form -->
  <div class="course-form" *ngIf="isCreating() || isEditing()">
    <div class="form-header">
      <h3>{{ isEditing() ? 'Edit Course' : 'Create New Course' }}</h3>
      <button class="btn-back" (click)="resetForm()">
        <mat-icon>arrow_back</mat-icon>
        <span>Back to Course List</span>
      </button>
    </div>
    
    <div class="form-group">
      <label class="required">Course Name</label>
      <input type="text" [(ngModel)]="newCourse.name" placeholder="Enter course name" required>
    </div>

    <div class="form-group">
      <label class="required">Description</label>
      <textarea [(ngModel)]="newCourse.description" placeholder="Enter course description" rows="4" required></textarea>
    </div>

    <div class="form-group">
      <label>Course Image</label>
      <div class="image-upload">
        <input type="file" 
               accept="image/*" 
               (change)="handleImageUpload($event)"
               #fileInput>
        <div class="image-preview" *ngIf="newCourse.image_url">
          <img [src]="newCourse.image_url" [alt]="newCourse.image_alt || newCourse.name">
        </div>
        <div class="error-message" *ngIf="imageError()">
          {{ imageError() }}
        </div>
      </div>
    </div>

    <div class="form-group">
      <label>Image Alt Text</label>
      <input type="text" [(ngModel)]="newCourse.image_alt" placeholder="Enter image alt text">
    </div>

    <div class="form-group">
      <label class="required">Course Price</label>
      <input type="text" [(ngModel)]="newCourse.price" placeholder="Enter price (e.g., â‚¹999)" required>
    </div>

    <div class="form-group">
      <label class="required">Duration</label>
      <input type="text" [(ngModel)]="newCourse.duration" placeholder="Enter duration (e.g., 6 months)" required>
    </div>

    <div class="form-group">
      <label>Weekly Commitment</label>
      <input type="text" [(ngModel)]="newCourse.weekly_commitment" placeholder="Enter weekly commitment">
    </div>

    <div class="form-group">
      <label class="required">Highlights</label>
      <div class="highlights-container">
        <div class="input-with-action" *ngFor="let highlight of newCourse.highlights; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.highlights[i]" 
                 placeholder="Enter highlight"
                 required>
          <button class="btn-icon" (click)="removeHighlight(i)" *ngIf="newCourse.highlights.length > 1">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addHighlight()">+ Add Highlight</button>
      </div>
    </div>

    <div class="form-group">
      <label class="required">Taglines</label>
      <div class="taglines-container">
        <div class="input-with-action" *ngFor="let tagline of newCourse.taglines; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.taglines[i]" 
                 placeholder="Enter tagline"
                 required>
          <button class="btn-icon" (click)="removeTagline(i)" *ngIf="newCourse.taglines.length > 1">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addTagline()">+ Add Tagline</button>
      </div>
    </div>

    <div class="form-group">
      <label>YouTube Videos</label>
      <div class="videos-container">
        <div class="input-with-action" *ngFor="let video of newCourse.videos || []; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.videos![i]" 
                 placeholder="Enter YouTube URL">
          <button class="btn-icon" (click)="removeVideo(i)">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addVideo()">+ Add Video</button>
      </div>
    </div>

    <div class="form-group">
      <label>Prerequisites</label>
      <div class="prerequisites-container">
        <div class="input-with-action" *ngFor="let prerequisite of newCourse.prerequisites || []; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.prerequisites![i]" 
                 placeholder="Enter prerequisite">
          <button class="btn-icon" (click)="removePrerequisite(i)">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addPrerequisite()">+ Add Prerequisite</button>
      </div>
    </div>

    <div class="form-group">
      <label>Learning Outcomes</label>
      <div class="outcomes-container">
        <div class="input-with-action" *ngFor="let outcome of newCourse.learning_outcomes || []; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.learning_outcomes![i]" 
                 placeholder="Enter learning outcome">
          <button class="btn-icon" (click)="removeLearningOutcome(i)">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addLearningOutcome()">+ Add Learning Outcome</button>
      </div>
    </div>

    <div class="form-group">
      <label>Language</label>
      <input type="text" [(ngModel)]="newCourse.language" placeholder="Course language (defaults to English)">
    </div>

    <div class="form-group">
      <label>Options</label>
      <div class="checkbox-group">
        <label>
          <input type="checkbox" [(ngModel)]="newCourse.featured">
          Featured Course
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="newCourse.certificate_offered">
          Certificate Offered
        </label>
      </div>
    </div>

    <div class="error-message" *ngIf="error()">{{ error() }}</div>
    <div class="success-message" *ngIf="message()">{{ message() }}</div>

    <div class="form-actions">
      <button class="btn-secondary" (click)="resetForm()">Cancel</button>
      <button class="btn-primary" 
              [disabled]="!validateCourse()" 
              (click)="isEditing() ? updateCourse() : createCourse()">
        {{ isEditing() ? 'Update Course' : 'Create Course' }}
      </button>
    </div>
  </div>

  <!-- Courses List -->
  <div class="courses-grid" *ngIf="!isCreating() && !isEditing()">
    <div class="loading-overlay" *ngIf="isLoading()">
      <div class="spinner"></div>
    </div>

    <div class="course-card" *ngFor="let course of courses()">
      <div class="course-image">
        <img [src]="course.image_url" [alt]="course.image_alt || course.name" *ngIf="course.image_url">
        <div class="no-image" *ngIf="!course.image_url">
          <span class="material-icons">image</span>
        </div>
      </div>
      
      <div class="course-content">
        <div class="course-status" [class.featured]="course.featured">
          {{ course.featured ? 'Featured' : 'Standard' }}
        </div>
        
        <h3>{{ course.name }}</h3>
        <p class="course-description">{{ course.description }}</p>
        
        <div class="course-details">
          <div class="detail-item">
            <span class="material-icons">schedule</span>
            {{ course.duration }}
          </div>
          <div class="detail-item">
            <span class="material-icons">currency_rupee</span>
            {{ course.price }}
          </div>
        </div>

        <div class="course-actions">
          <button class="btn-icon" (click)="startEdit(course)">
            <span class="material-icons">edit</span>
            Edit
          </button>
          <button class="btn-icon delete" (click)="deleteCourse(course)">
            <span class="material-icons">delete</span>
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
