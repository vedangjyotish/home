<div class="courses-container">
  <div class="courses-header">
    <h2>Course Management</h2>
    <button class="btn-primary" (click)="isCreating.set(true)" *ngIf="!isCreating() && !isEditing()">Create New Course</button>
  </div>

  <!-- Course Form -->
  <div class="course-form" *ngIf="isCreating() || isEditing()">
    <div class="form-header">
      <h3>{{ isEditing() ? 'Edit Course' : 'Create New Course' }}</h3>
      <button class="btn-back" (click)="resetForm()">
        <mat-icon>arrow_back</mat-icon>
        <span>Back to Course List</span>
      </button>
    </div>

    <form [formGroup]="courseForm" (ngSubmit)="isEditing() ? updateCourse() : createCourse()">
      <div class="form-grid">
        <!-- Left Column -->
        <div class="form-column">
          <div class="form-group">
            <label class="required">Course Name</label>
            <input type="text" formControlName="name" placeholder="Enter course name" required>
          </div>

          <div class="form-group">
            <label class="required">Description</label>
            <textarea formControlName="description" placeholder="Enter course description" rows="4" required></textarea>
          </div>

          <div class="form-group">
            <label>Course Image</label>
            <div class="image-upload">
              <input type="file" 
                     accept="image/*" 
                     (change)="handleImageUpload($event)"
                     #fileInput>
              <div class="image-preview" *ngIf="image_url">
                <img [src]="image_url" [alt]="image_alt">
              </div>
              <div class="error-message" *ngIf="imageError()">
                {{ imageError() }}
              </div>
            </div>
          </div>

          <div class="form-group">
            <label>Image Alt Text</label>
            <input type="text" formControlName="image_alt" placeholder="Enter image alt text">
          </div>

          <div class="form-group">
            <label class="required">Course Price</label>
            <input type="text" 
                   formControlName="price" 
                   placeholder="Enter price (e.g., â‚¹4999)" 
                   (input)="formatPrice($event)"
                   required>
          </div>

          <div class="form-group">
            <label class="required">Duration</label>
            <input type="text" formControlName="duration" placeholder="Enter duration (e.g., 3 months)" required>
          </div>

          <div class="form-group">
            <label>Weekly Commitment</label>
            <input type="text" formControlName="weekly_commitment" placeholder="e.g., 6-8 hours">
          </div>

          <div class="form-group">
            <label>Language</label>
            <input type="text" formControlName="language" placeholder="Course language (defaults to English)">
          </div>

          <div class="form-group">
            <label>Teacher Name</label>
            <input type="text" formControlName="teacher_name" placeholder="Enter teacher name">
          </div>
        </div>

        <!-- Right Column -->
        <div class="form-column">
          <div class="form-group">
            <label class="required">Highlights</label>
            <div class="array-inputs">
              <div class="input-with-action" *ngFor="let control of highlights.controls; let i = index">
                <input type="text" 
                       [formControl]="getControl(control)"
                       placeholder="Enter highlight"
                       required>
                <button type="button" class="btn-icon" (click)="removeHighlight(i)" *ngIf="highlights.length > 1">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <button type="button" class="btn-secondary" (click)="addHighlight()">
                <mat-icon>add</mat-icon>
                Add Highlight
              </button>
            </div>
          </div>

          <div class="form-group">
            <label class="required">Taglines</label>
            <div class="array-inputs">
              <div class="input-with-action" *ngFor="let control of taglines.controls; let i = index">
                <input type="text" 
                       [formControl]="getControl(control)"
                       placeholder="Enter tagline"
                       required>
                <button type="button" class="btn-icon" (click)="removeTagline(i)" *ngIf="taglines.length > 1">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <button type="button" class="btn-secondary" (click)="addTagline()">
                <mat-icon>add</mat-icon>
                Add Tagline
              </button>
            </div>
          </div>

          <div class="form-group">
            <label>YouTube Videos</label>
            <div class="array-inputs">
              <div class="input-with-action" *ngFor="let control of videos.controls; let i = index">
                <input type="text" 
                       [formControl]="getControl(control)"
                       placeholder="Enter YouTube URL">
                <button type="button" class="btn-icon" (click)="removeVideo(i)">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <button type="button" class="btn-secondary" (click)="addVideo()">
                <mat-icon>add</mat-icon>
                Add Video
              </button>
            </div>
          </div>

          <div class="form-group">
            <label>Prerequisites</label>
            <div class="array-inputs">
              <div class="input-with-action" *ngFor="let control of prerequisites.controls; let i = index">
                <input type="text" 
                       [formControl]="getControl(control)"
                       placeholder="Enter prerequisite">
                <button type="button" class="btn-icon" (click)="removePrerequisite(i)">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <button type="button" class="btn-secondary" (click)="addPrerequisite()">
                <mat-icon>add</mat-icon>
                Add Prerequisite
              </button>
            </div>
          </div>

          <div class="form-group">
            <label>Learning Outcomes</label>
            <div class="array-inputs">
              <div class="input-with-action" *ngFor="let control of learningOutcomes.controls; let i = index">
                <input type="text" 
                       [formControl]="getControl(control)"
                       placeholder="Enter learning outcome">
                <button type="button" class="btn-icon" (click)="removeLearningOutcome(i)">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
              <button type="button" class="btn-secondary" (click)="addLearningOutcome()">
                <mat-icon>add</mat-icon>
                Add Learning Outcome
              </button>
            </div>
          </div>

          <div class="form-group">
            <label>Options</label>
            <div class="checkbox-group">
              <label>
                <input type="checkbox" formControlName="featured">
                Featured Course
              </label>
              <label>
                <input type="checkbox" formControlName="certificate_offered">
                Certificate Offered
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>Course Status</label>
            <select formControlName="status">
              <option value="draft">Draft</option>
              <option value="published">Published</option>
              <option value="archived">Archived</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-primary" [disabled]="!courseForm.valid">
          {{ isEditing() ? 'Update Course' : 'Create Course' }}
        </button>
      </div>
    </form>

    <div class="error-message" *ngIf="error()">{{ error() }}</div>
    <div class="success-message" *ngIf="message()">{{ message() }}</div>
  </div>

  <!-- Courses List -->
  <div class="courses-grid" *ngIf="!isCreating() && !isEditing()">
    <div class="loading-overlay" *ngIf="isLoading()">
      <div class="spinner"></div>
    </div>

    <div class="course-card" (click)="startEdit(course)" [class.clickable]="true" *ngFor="let course of courses()">
      <div class="course-image">
        <img [src]="course.image_url" [alt]="course.image_alt || course.name" *ngIf="course.image_url">
        <div class="no-image" *ngIf="!course.image_url">
          <span class="material-icons">image</span>
        </div>
      </div>
      
      <div class="course-content">
        <div class="course-status" [class.featured]="course.featured">
          {{ course.featured ? 'Featured' : 'Standard' }}
        </div>
        
        <h3>{{ course.name }}</h3>
        <p class="course-description">{{ course.description }}</p>
        
        <div class="course-details">
          <div class="detail-item">
            <span class="material-icons">schedule</span>
            {{ course.duration }}
          </div>
          <div class="detail-item">
            <span class="material-icons">currency_rupee</span>
            {{ displayPrice(course.price) }}
          </div>
        </div>

        <div class="course-actions">
          <button class="btn-icon" (click)="startEdit(course, $event)">
            <span class="material-icons">edit</span>
            <span>Edit</span>
          </button>
          <button class="btn-icon" (click)="deleteCourse(course, $event)">
            <span class="material-icons">delete</span>
            <span>Delete</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
