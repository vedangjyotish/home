<div class="courses-container">
  <div class="courses-header">
    <h2>Course Management</h2>
    <button class="btn-primary" (click)="isCreating.set(true)" *ngIf="!isCreating() && !isEditing()">Create New Course</button>
  </div>

  <!-- Course Form -->
  <div class="course-form" *ngIf="isCreating() || isEditing()">
    <h3>{{ isEditing() ? 'Edit Course' : 'Create New Course' }}</h3>
    
    <div class="form-group">
      <label class="required">Course Name</label>
      <input type="text" [(ngModel)]="newCourse.name" placeholder="Enter course name" required>
    </div>

    <div class="form-group">
      <label class="required">Description</label>
      <textarea [(ngModel)]="newCourse.description" placeholder="Enter course description" rows="4" required></textarea>
    </div>

    <div class="form-group">
      <label>Course Image</label>
      <div class="image-upload">
        <input type="file" 
               accept="image/*" 
               (change)="handleImageUpload($event)"
               #fileInput>
        <div class="image-preview" *ngIf="newCourse.image_url">
          <img [src]="newCourse.image_url" [alt]="newCourse.image_alt || newCourse.name">
        </div>
        <div class="error-message" *ngIf="imageError()">
          {{ imageError() }}
        </div>
      </div>
    </div>

    <div class="form-group">
      <label>Image Alt Text</label>
      <input type="text" [(ngModel)]="newCourse.image_alt" placeholder="Enter image alt text">
    </div>

    <div class="form-group">
      <label class="required">Course Price</label>
      <input type="text" [(ngModel)]="newCourse.price" placeholder="Enter price (e.g., â‚¹999)" required>
    </div>

    <div class="form-group">
      <label class="required">Duration</label>
      <input type="text" [(ngModel)]="newCourse.duration" placeholder="Enter duration (e.g., 6 months)" required>
    </div>

    <div class="form-group">
      <label>Weekly Commitment</label>
      <input type="text" [(ngModel)]="newCourse.weekly_commitment" placeholder="Enter weekly commitment">
    </div>

    <div class="form-group">
      <label class="required">Highlights</label>
      <div class="highlights-container">
        <div class="input-with-action" *ngFor="let highlight of newCourse.highlights; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.highlights[i]" 
                 placeholder="Enter highlight"
                 required>
          <button class="btn-icon" (click)="removeHighlight(i)" *ngIf="newCourse.highlights.length > 1">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addHighlight()">+ Add Highlight</button>
      </div>
    </div>

    <div class="form-group">
      <label class="required">Taglines</label>
      <div class="taglines-container">
        <div class="input-with-action" *ngFor="let tagline of newCourse.taglines; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.taglines[i]" 
                 placeholder="Enter tagline"
                 required>
          <button class="btn-icon" (click)="removeTagline(i)" *ngIf="newCourse.taglines.length > 1">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addTagline()">+ Add Tagline</button>
      </div>
    </div>

    <div class="form-group">
      <label>YouTube Videos</label>
      <div class="videos-container">
        <div class="input-with-action" *ngFor="let video of newCourse.videos || []; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.videos![i]" 
                 placeholder="Enter YouTube URL">
          <button class="btn-icon" (click)="removeVideo(i)">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addVideo()">+ Add Video</button>
      </div>
    </div>

    <div class="form-group">
      <label>Prerequisites</label>
      <div class="prerequisites-container">
        <div class="input-with-action" *ngFor="let prerequisite of newCourse.prerequisites || []; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.prerequisites![i]" 
                 placeholder="Enter prerequisite">
          <button class="btn-icon" (click)="removePrerequisite(i)">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addPrerequisite()">+ Add Prerequisite</button>
      </div>
    </div>

    <div class="form-group">
      <label>Learning Outcomes</label>
      <div class="outcomes-container">
        <div class="input-with-action" *ngFor="let outcome of newCourse.learning_outcomes || []; let i = index">
          <input type="text" 
                 [(ngModel)]="newCourse.learning_outcomes![i]" 
                 placeholder="Enter learning outcome">
          <button class="btn-icon" (click)="removeLearningOutcome(i)">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <button class="btn-secondary" (click)="addLearningOutcome()">+ Add Learning Outcome</button>
      </div>
    </div>

    <div class="form-group">
      <label>Language</label>
      <input type="text" [(ngModel)]="newCourse.language" placeholder="Course language (defaults to English)">
    </div>

    <div class="form-group">
      <label>Options</label>
      <div class="checkbox-group">
        <label>
          <input type="checkbox" [(ngModel)]="newCourse.featured">
          Featured Course
        </label>
        <label>
          <input type="checkbox" [(ngModel)]="newCourse.certificate_offered">
          Certificate Offered
        </label>
      </div>
    </div>

    <div class="error-message" *ngIf="error()">{{ error() }}</div>
    <div class="success-message" *ngIf="message()">{{ message() }}</div>

    <div class="form-actions">
      <button class="btn-secondary" (click)="resetForm()">Cancel</button>
      <button class="btn-primary" 
              [disabled]="!validateCourse()" 
              (click)="isEditing() ? updateCourse() : createCourse()">
        {{ isEditing() ? 'Update Course' : 'Create Course' }}
      </button>
    </div>
  </div>

  <!-- Courses List -->
  <div class="courses-list" *ngIf="!isCreating() && !isEditing()">
    <div class="loading" *ngIf="isLoading()">Loading courses...</div>
    <div class="no-courses" *ngIf="!isLoading() && !courses().length">
      No courses found. Create your first course!
    </div>
    
    <div class="course-card" *ngFor="let course of courses()">
      <div class="course-header">
        <h3>{{ course.name }}</h3>
        <div class="course-actions">
          <button class="btn-secondary" (click)="startEdit(course)">Edit</button>
          <button class="btn-danger" (click)="deleteCourse(course)">Delete</button>
        </div>
      </div>

      <div class="card-section">
        <img *ngIf="course.image_url" [src]="course.image_url" [alt]="course.image_alt || course.name">
      </div>

      <div class="card-section">
        <p class="price">{{ course.price }}</p>
        <p class="duration">{{ course.duration }}</p>
        <p *ngIf="course.weekly_commitment" class="commitment">{{ course.weekly_commitment }}</p>
      </div>

      <div class="card-section description" *ngIf="course.description">
        <h4>Description</h4>
        <p>{{ course.description }}</p>
      </div>

      <div class="card-section highlights" *ngIf="course.highlights?.length">
        <h4>Highlights</h4>
        <ul>
          <li *ngFor="let highlight of course.highlights">{{ highlight }}</li>
        </ul>
      </div>

      <div class="card-section taglines" *ngIf="course.taglines?.length">
        <h4>Taglines</h4>
        <ul>
          <li *ngFor="let tagline of course.taglines">{{ tagline }}</li>
        </ul>
      </div>

      <div class="card-section videos" *ngIf="course.videos?.length">
        <h4>Videos</h4>
        <ul>
          <li *ngFor="let video of course.videos">{{ video }}</li>
        </ul>
      </div>

      <div class="card-section prerequisites" *ngIf="course.prerequisites?.length">
        <h4>Prerequisites</h4>
        <ul>
          <li *ngFor="let prerequisite of course.prerequisites">{{ prerequisite }}</li>
        </ul>
      </div>

      <div class="card-section outcomes" *ngIf="course.learning_outcomes?.length">
        <h4>Learning Outcomes</h4>
        <ul>
          <li *ngFor="let outcome of course.learning_outcomes">{{ outcome }}</li>
        </ul>
      </div>

      <div class="card-section meta">
        <p *ngIf="course.language">Language: {{ course.language }}</p>
        <p *ngIf="course.certificate_offered">Certificate Offered</p>
        <p *ngIf="course.featured">Featured Course</p>
        <p>Status: {{ course.status || 'draft' }}</p>
      </div>
    </div>
  </div>
</div>
